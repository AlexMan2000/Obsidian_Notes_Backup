# Capacitive Touchscreen
## Physical Structure
> ![](2_Touchscreen_Op_amp.assets/image-20230319081700646.png)
> **ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°:**
> - ç”µå®¹å±å¹•æ˜¯ç”±ä¸€ä¸ªä¸ªåƒç´ ç‚¹æ„æˆçš„ï¼Œ æ¯ä¸ªåƒç´ ç‚¹éƒ½æ˜¯å¦‚å›¾æ‰€ç¤ºçš„ç»“æ„ï¼Œä¸Šç«¯æ˜¯ä¸€æ ¹å‚ç›´æ”¾ç½®çš„ç”µæ`E1`ï¼Œä¸‹ç«¯æ˜¯ä¸€æ ¹æ°´å¹³æ–¹å‘æ”¾ç½®çš„ç”µæ`E2`ã€‚ä¸¤ä¸ªç”µæå‡æ˜¯å¯¼ç”µæè´¨`Conductor`ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
> ![](2_Touchscreen_Op_amp.assets/image-20230319082700915.png)
> - è§¦ç‚¹ä¸ä¸Šç«¯ç”µæ`E1`ä¹‹é—´æ˜¯ç»ç¼˜ææ–™ï¼Œä¸Šç«¯ç”µæ`E1`ä¸ä¸‹ç«¯ç”µæ`E2`ä¹‹é—´ä¹Ÿæ˜¯ç»ç¼˜ææ–™ã€‚
> - å±å¹•çš„ä¸Šç«¯è·ç¦»`ä¸Šç«¯ç”µæ`ä»æœ‰è·ç¦»ï¼Œåœ¨å›¾ä¸­ç”¨ç”µå®¹$C_{E1-F}$è¡¨ç¤ºã€‚ç”µæä¸ä¸‹ç«¯ä¹‹é—´çš„ç”µå®¹ç”¨$C_0$è¡¨ç¤ºã€‚
> - è§¦ç‚¹ä¸ä¸‹æ¿çš„éç”µæåŒºåŸŸä¹Ÿæ˜¯ç»ç¼˜ææ–™ï¼Œç”¨$C_{F-E2}$è¡¨ç¤ºã€‚





## How to detect touchpoint
> æœ¬è´¨ä¸Šå¯¹äºæ¯ä¸€ä¸ªåƒç´ ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦æµ‹é‡è¿™ä¸ªåƒç´ ç‚¹æ˜¯ä¸æ˜¯è§¦ç‚¹å³å¯(`0-æ²¡æœ‰è§¦æ‘¸ï¼Œ1-è§¦æ‘¸`ï¼Œæ˜¯ä¸€ä¸ª`binary`çš„çŠ¶æ€)ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­`E1,E2`ä¸¤ä¸ª`Terminals`ä¹‹é—´çš„ç­‰æ•ˆç”µå®¹æ˜¯å¦å‘ç”Ÿå˜åŒ–äº†æ”¹å˜ã€‚
> - å½“æˆ‘ä»¬çš„æ‰‹æŒ‡æ²¡æœ‰æ¥è§¦å±å¹•çš„æ—¶å€™ï¼Œç”µè·¯çŠ¶æ€å¦‚å·¦å›¾ï¼Œä¸Šä¸‹ç”µæä¹‹é—´çš„ç”µå®¹å°±æ˜¯$C_0$ã€‚å½“æ‰‹æŒ‡è§¦æ‘¸åˆ°æŸä¸ªåƒç´ ç‚¹çš„æ—¶å€™ï¼Œç”µè·¯çŠ¶æ€å¦‚å³å›¾æ‰€ç¤ºï¼Œ`E1,E2`ä¹‹é—´çš„ç­‰æ•ˆç”µé˜»ä¼šå‘ç”Ÿæ”¹å˜ã€‚
> - ä¸‹å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œ`E1,E2`é—´çš„ç­‰æ•ˆç”µé˜»ä¼šå¢å¤§ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥åˆ¤æ–­è¿™ä¸ªåƒç´ ç‚¹è¢«è§¦æ‘¸äº†ã€‚
> ![](2_Touchscreen_Op_amp.assets/image-20230319082610980.png)





# Measure Capacitor
> æƒ¯ä¾‹ä¸Šï¼Œæˆ‘ä»¬ä¼šé€‰å–ä¸‹é¢çš„ç”µè·¯ç»“æ„æ¥å¯¹ç”µå®¹è¿›è¡Œæµ‹é‡:
> ![](2_Touchscreen_Op_amp.assets/image-20230319082822671.png)
> ğŸ””: ç”µè·¯æœ‰ä¸¤ç§çŠ¶æ€ï¼š
> ![](2_Touchscreen_Op_amp.assets/image-20230319083038188.png)
> `Phase 1`çš„`s3 is on`æ˜¯ä¸ºäº†è®©ç”µå®¹$C_{ref}$çš„ç”µè·è½½é‡ä¸º$0$, å› ä¸ºç”µå®¹ä¸¤ç«¯è¢«çŸ­è·¯ï¼Œæ ¹æ®$Q=C\cdot V$, ç”µå‹ä¸ºé›¶, æ²¡æœ‰åŠ¨åŠ›å°†ç”µå­ä»ä¸‹æ¿è¿è¾“åˆ°ä¸Šæ¿ï¼Œæ‰€ä»¥$V=0$, ä¸”ç”µå®¹ä¸ºé›¶ã€‚`Phase 1`çš„`s1 is on`æ˜¯ä¸ºäº†è®©ç”µå®¹$C_{eq,E1-E2}$å……ä¸Šç”µã€‚
> æœ¬è´¨ä¸Šï¼Œ`Phase1`çš„ä½œç”¨å°±æ˜¯è®©ä¸¤ä¸ªç”µå®¹å™¨éƒ½å……ä¸Šå›ºå®šæ•°é‡çš„ç”µè·ã€‚å› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªé‡è¦çš„æ€§è´¨ï¼Œå°±æ˜¯åœ¨æ²¡æœ‰å¤–éƒ¨ç”µå‹çš„æ—¶å€™ï¼Œç”µå®¹å™¨çš„ç”µè·é‡æ˜¯ä¿æŒä¸å˜çš„ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨`Phase 1`å’Œ`Phase 2`çš„æ€»ç”µå®¹é‡ä¸å‘ç”Ÿæ”¹å˜ï¼Œå¾—åˆ°ä¸‹åˆ—çš„å…³ç³»:
> ![](2_Touchscreen_Op_amp.assets/image-20230319085031017.png)![](2_Touchscreen_Op_amp.assets/image-20230319085045613.png)![](2_Touchscreen_Op_amp.assets/image-20230319100111607.png)






# Charge-Sharing Algorithms
## Basics
> ä¸Šå›¾ä¸­æˆ‘ä»¬æ‰€ä½¿ç”¨çš„è¿™ç§ç‰¹æ®Šçš„ç”µè·¯åˆ†ææ–¹æ³•è¢«ç§°ä¸º`Charge Sharing`ã€‚
> `Charge Sharing`æ˜¯æŒ‡ç”µå®¹å™¨ä¹‹é—´çš„ç”µè·å…±äº«ã€‚åœ¨ä¸€ä¸ªç”µè·¯çš„ä¸åŒç¨³å®šé˜¶æ®µä¹‹é—´ï¼Œæœ‰ä¸€æ¡é‡è¦çš„åŸºæœ¬è§„åˆ™æ˜¯çœŸå®çš„ï¼šæ‰€æœ‰ç”µå®¹å™¨å‚¨å­˜çš„æ€»ç”µè·å¿…é¡»å§‹ç»ˆç›¸åŒã€‚ä¸‹å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨`Phase 2`çš„æ—¶å€™ï¼Œ$C_{eq}$å’Œ$C_{ref}$çš„ç”µè·é‡å¹³å‡åˆ†é…äº†ï¼Œéƒ½å˜æˆäº†$5C$ã€‚
>  ![](2_Touchscreen_Op_amp.assets/image-20230318222144404.png)



## Algorithm Details
> [Note17B](Typed_Notes/Note17B.pdf)
> [ChargeSharingWalkThroughNotes](Typed_Notes/ChargeSharingWalkThroughNotes.pdf)



# Op-amp Basics
## Structure
> ![](2_Touchscreen_Op_amp.assets/image-20230319164822432.png)![](2_Touchscreen_Op_amp.assets/image-20230319165048742.png)![](2_Touchscreen_Op_amp.assets/image-20230319165131662.png)



## Output Characteristic
> ![](2_Touchscreen_Op_amp.assets/image-20230319165145144.png)



## Measure Touchpoint
> ![](2_Touchscreen_Op_amp.assets/image-20230319165814667.png)![](2_Touchscreen_Op_amp.assets/image-20230319170020314.png)
> ğŸ””ï¼šæœ¬è´¨ä¸Šï¼Œ$V_{ref}$çš„ä½œç”¨ç›¸å½“äºä¸€ä¸ª`flag`, æˆ–è€…ä¸€ä¸ªæ¯”è¾ƒçš„å¯¹è±¡ï¼Œå‚ç…§ç‚¹ã€‚
> ğŸ””: å› ä¸º$V_{ana,touch}$æ€»æ˜¯å¤§äº$V_{ana,no-touch}$, æ‰€ä»¥æˆ‘ä»¬è¦æ±‚å½“ç”¨æˆ·è§¦ç¢°åˆ°äº†ç”µå®¹å±çš„åƒç´ æ—¶ï¼Œ$V_{ana,touch}>V_{ref}$ã€‚åä¹‹åˆ™$V_{ana,no-touch}<V_{ref}$ã€‚æ‰€ä»¥$V_{ref}$ çš„è®¾ç½®å°±å°¤å…¶é‡è¦ã€‚



### How to choose Vref
> ![](2_Touchscreen_Op_amp.assets/image-20230319165919605.png)![](2_Touchscreen_Op_amp.assets/image-20230319170105771.png)
> ğŸ””: ä¸€èˆ¬è€Œè¨€ï¼Œ$V_{ana,touch}$å’Œ$V_{ana,no~touch}$ä¹‹é—´çš„å·®å€¼å¾ˆå°ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„$V_{ref}$çš„å–å€¼å¾ˆæœ‰é™, ä¸€èˆ¬ä¼šé€‰åœ¨$V_{ana,touch}$å’Œ$V_{ana,no-touch}$çš„ä¸­ç‚¹ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§é™åº¦çš„é¿å…è¯¯å·®çš„å‡ºç°ã€‚



### How to choose Cref
> ğŸ””: æœ‰æ²¡æœ‰åŠæ³•ä½¿å¾—æˆ‘ä»¬çš„$V_{ref}$å–å€¼æ›´åŠ çµæ´»å‘¢? æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´$C_{ref}$çš„å¤§å°æ¥å®ç°ã€‚å½“$C_{ref}$å’Œ$C_{eq}$, $\Delta C$çš„å¤§å°ç›¸è¿‘çš„æ—¶å€™, $V_{ana, touch}$å’Œ$V_{ana,no-touch}$ä¹‹é—´çš„å·®å€¼å°±ä¼šæ¯”è¾ƒå¤§ï¼Œè¿™æ ·æˆ‘ä»¬$V_{ref}$è°ƒæ•´çš„ä½™åœ°å°±ä¼šæ›´å¤§ä¸€äº›ã€‚
> ![](2_Touchscreen_Op_amp.assets/image-20230319165946167.png)![](2_Touchscreen_Op_amp.assets/image-20230319170354731.png)




# Resources
> [Note17](Typed_Notes/Note17.pdf)
> [Note17B](Typed_Notes/Note17B.pdf)
> [Written_Notes17](Typed_Notes/Written_Notes17.pdf)
> [ChargeSharingWalkThroughNotes](Typed_Notes/ChargeSharingWalkThroughNotes.pdf)
> https://www.bilibili.com/video/BV1wi4y1u7gx?p=19&vd_source=66aa12d38833505f6c2216f089511404 Lecture 19




